# WebSocket сервер для организации управления приложениями из браузера

Авторизованные пользователи привязывают приложения к своему аккаунту и управляют ими из браузера,
с любого устройства подключенного к сети.  

* Приложениям не требуется какой либо интерфейс пользователя;
* Не накладывается ограничения на механизм привязки приложения к аккаунту;
* Управляющий браузер и приложение могут находится за NAT;
* Привязка к аккаунту нескольких приложений;
* Привязка приложения к нескольким аккаунтам; 

Типовая схема взаимодействия:

```text
+---------+   wss   +-----------+   wss   +-------------+
| Browser |<=======>| WS Server |<=======>| Application |
+---------+         +-----------+         +-------------+
       ^                  ^|                 ^
       |                  || https           |
        \                 |v                /
         \          +-----------+          /
          `-------->|  Control  |<--------'
         https ajax |   server  | https api
                    +-----------+
```

## Формат сообщений

Сообщения передаются к формате `json`.
 
Сообщения от пользователя являются управляющими и передаются конкретному приложению.
Сообщения от приложения являются информирующими и передаются всем подключениям аккаунтов
к которым привязано приложение.
Также есть несколько уведомительных сообщений.

### Браузер

Исходящее, отправка сообщения приложению:

```json
{
  "Action": "sendData",
  "To": "123e4567-e89b-12d3-a456-426655440000", // Application installation uuid
  "Data": {
    // A payload data
  }
}
```

Входящее, получение сообщения приложения:

```json
{
  "Action": "receivedData",
  "From": "123e4567-e89b-12d3-a456-426655440000", // Application installation uuid
  "Data": {
    // A payload data
  }
}
```

Исходящее, запрос на получение подключенных в данный момент приложений:

```json
{
  "Action": "getConnected",
  "List": [
      // Application installation uuid
      "123e4567-e89b-12d3-a456-426655440000"
      //...
  ]
}
```

Входящее, список подключенных приложений, если отправляется в ответ на `getConnected`,
то содержит полный список подключенных, либо при подключении приложения к серверу - в списке только одно приложение:

```json
{
  "Action": "connected",
  "List": [
    {
      "Aid": "123e4567-e89b-12d3-a456-426655440000", // Application installation uuid
      "Ip": "255.255.255.255"
    }
  ]
}
```

Входящее, список отключившихся приложения от сервера:

```json
{
  "Action": "disconnected",
  "List": [
    // Application installation uuid
    "123e4567-e89b-12d3-a456-426655440000"
  ]
}
```

Входящее, список привязанных приложений к аккаунту:

```json
{
  "Action": "attached",
  "List": [
    // Application installation uuid
    "123e4567-e89b-12d3-a456-426655440000"
  ]
}
```

Входящее, список отвязанных приложений от аккаунта:

```json
{
  "Action": "detached",
  "List": [
    // Application installation uuid
    "123e4567-e89b-12d3-a456-426655440000"
  ]
}
```

### Приложение

Исходящее, отправка сообщения браузеру(-ам):

```json
{
  "Action": "sendData",
  "Data": {
    // A payload data
  }
}
```

Входящее, получение сообщения браузера:

```json
{
  "Action": "receivedData",
  "From": 1234567890, // User id
  "Data": {
    // A payload data
  }
}
```
